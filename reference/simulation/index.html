
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Simulating atom trapping around nanostructures has never been easier." name="description"/>
<meta content="Jérémy Berroir &amp; Adrien Bouscal" name="author"/>
<link href="../../assets/favicon.png" rel="shortcut icon"/>
<meta content="mkdocs-1.1.2, mkdocs-material-6.2.2" name="generator"/>
<title>Simulation - nanotrappy Documentation</title>
<link href="../../assets/stylesheets/main.73f7c429.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.39b8e14a.min.css" rel="stylesheet"/>
<meta content="#4051b5" name="theme-color"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
<script>document.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("click",function(e){if(e.target instanceof HTMLElement){var t=e.target.closest("a[href^=http]");t&&ga("send","event","outbound","click",t.href)}})})</script>
<meta content="website" property="og:type">
<meta content="nanotrappy Documentation - Simulation" property="og:title">
<meta content="Simulating atom trapping around nanostructures has never been easier." property="og:description">
<meta content="None" property="og:url">
<meta content="assets/images/W1_v2.png" property="og:image">
<meta content="image/png" property="og:image:type">
<meta content="device-width" property="og:image:width"/>
<!-- 1080 before -->
<meta content="568" property="og:image:height"/>
<!-- <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@squidfunk">
  <meta name="twitter:creator" content="@squidfunk">
  <meta name="twitter:title" content="nanotrappy Documentation - Simulation">
  <meta name="twitter:description" content="Simulating atom trapping around nanostructures has never been easier.">
  <meta name="twitter:image" content="assets/images/W1_v2.png"> -->
<link href="../../assets/stylesheets/overrides.c462ebf7.min.css" rel="stylesheet">
</link></meta></meta></meta></meta></meta></meta></head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#nanotrappy.trapping.simulation">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
<aside class="md-announce">
<div class="md-announce__inner md-grid md-typeset">
<a href="https://github.com/jrmbr">
  For updates follow <strong>@jrmbr and @abouscal</strong> on
  <span class="twemoji twitter">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</span>
<strong>Github</strong>
</a>
</div>
</aside>
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header-nav md-grid">
<a aria-label="nanotrappy Documentation" class="md-header-nav__button md-logo" href="../.." title="nanotrappy Documentation">
<img alt="logo" src="../../assets/my_favicon_white.svg"/>
</a>
<label class="md-header-nav__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header-nav__title" data-md-component="header-title">
<div class="md-header-nav__ellipsis">
<div class="md-header-nav__topic">
<span class="md-ellipsis">
            nanotrappy Documentation
          </span>
</div>
<div class="md-header-nav__topic">
<span class="md-ellipsis">
            
              Simulation
            
          </span>
</div>
</div>
</div>
<label class="md-header-nav__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" data-md-component="search-reset" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header-nav__source">
<a class="md-source" href="https://github.com/LKB-QuantumNetworks/nanotrappy" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    LKB/nanotrappy
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
      Home
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../getting-started/">
        Getting started
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="../atomicsystem/">
        Reference
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../credits/">
      Credits
    </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="nanotrappy Documentation" class="md-nav__button md-logo" href="../.." title="nanotrappy Documentation">
<img alt="logo" src="../../assets/my_favicon_white.svg"/>
</a>
    nanotrappy Documentation
  </label>
<div class="md-nav__source">
<a class="md-source" href="https://github.com/LKB-QuantumNetworks/nanotrappy" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    LKB/nanotrappy
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
      Home
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" id="nav-2" type="checkbox"/>
<label class="md-nav__link" for="nav-2">
      Getting started
      <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Getting started" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-2">
<span class="md-nav__icon md-icon"></span>
        Getting started
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/">
      Installation
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorial/">
      Tutorial
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../modeformatting/">
      Formatting your data
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../casimirpolder/">
      On Casimir Polder interactions
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="nav-3" id="nav-3" type="checkbox"/>
<label class="md-nav__link" for="nav-3">
      Reference
      <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Reference" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-3">
<span class="md-nav__icon md-icon"></span>
        Reference
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../atomicsystem/">
      Atomic system
    </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
        Simulation
        <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
      Simulation
    </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation">
    nanotrappy.trapping.simulation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation">
    Simulation
  </a>
<nav aria-label="Simulation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.lmbdas_modes">
    lmbdas_modes
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.compute_potential">
    compute_potential()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.compute_potential_1D">
    compute_potential_1D()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.compute_potential_1D_gui">
    compute_potential_1D_gui()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.compute_potential_gui">
    compute_potential_gui()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.compute_potential_gui2">
    compute_potential_gui2()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.exists_in_past_simulations">
    exists_in_past_simulations()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.restrict1D">
    restrict1D()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.restrict2D">
    restrict2D()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.save">
    save()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.set_current_params">
    set_current_params()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.set_wavelengths_indices">
    set_wavelengths_indices()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.total_potential">
    total_potential()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.parse_lmbdas">
    parse_lmbdas()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../trap/">
      Trap
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../beam/">
      Beam
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../viz/">
      Visualization
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../credits/">
      Credits
    </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation">
    nanotrappy.trapping.simulation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation">
    Simulation
  </a>
<nav aria-label="Simulation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.lmbdas_modes">
    lmbdas_modes
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.compute_potential">
    compute_potential()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.compute_potential_1D">
    compute_potential_1D()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.compute_potential_1D_gui">
    compute_potential_1D_gui()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.compute_potential_gui">
    compute_potential_gui()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.compute_potential_gui2">
    compute_potential_gui2()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.exists_in_past_simulations">
    exists_in_past_simulations()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.restrict1D">
    restrict1D()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.restrict2D">
    restrict2D()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.save">
    save()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.set_current_params">
    set_current_params()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.set_wavelengths_indices">
    set_wavelengths_indices()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.Simulation.total_potential">
    total_potential()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nanotrappy.trapping.simulation.parse_lmbdas">
    parse_lmbdas()
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<h1>Simulation</h1>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" href="#nanotrappy.trapping.simulation" id="nanotrappy.trapping.simulation" style="visibility: hidden; position: absolute;">
<a class="headerlink" href="#nanotrappy.trapping.simulation" title="Permanent link">¶</a></h2>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="nanotrappy.trapping.simulation.Simulation">
<code>Simulation</code>
<a class="headerlink" href="#nanotrappy.trapping.simulation.Simulation" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<p>Simulation class. Bundle of all the predefined objects that are needed for computing the potentials.</p>
<p><strong>Attributes:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>atomic</code></td>
<td><code>system (atomicsytem</code></td>
<td>
<p>Atomic system that we want to trap (has an atom and a hyperfine level as attributes among others)</p>
</td>
</tr>
<tr>
<td><code>material</code></td>
<td><code>material</code></td>
<td>
<p>See NanoTrap.utils.materials for available materials. They can be easily added by the user.</p>
</td>
</tr>
<tr>
<td><code>trap</code></td>
<td><code>trap</code></td>
<td>
<p>trap object with the beams used for the specified trap scheme.</p>
</td>
</tr>
<tr>
<td><code>surface</code></td>
<td><code>surface</code></td>
<td>
<p>Plane or Cylinder, to get a local mask for the CP interaction (always computed as -C3/r**3).</p>
</td>
</tr>
<tr>
<td><code>data_folder</code></td>
<td><code>str</code></td>
<td>
<p>Folder where your modes with the right formatting are saved. The class will fetch the modes corresponding to the trap in this folder (if they exist).</p>
</td>
</tr>
</tbody>
</table>
<div class="doc doc-children">
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="nanotrappy.trapping.simulation.Simulation.lmbdas_modes">
<code class="highlight">
lmbdas_modes        </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-property"><code>property</code></small>
<small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
</span>
<a class="headerlink" href="#nanotrappy.trapping.simulation.Simulation.lmbdas_modes" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Returns a list of all the wavelengths available in the modes present in the data folder</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Passed as property so it is updated anytime the trap is changed</p>
</div>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="nanotrappy.trapping.simulation.Simulation.compute_potential">
<code class="highlight language-python">
compute_potential<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span> </code>
<a class="headerlink" href="#nanotrappy.trapping.simulation.Simulation.compute_potential" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Computes the potential in 2D for each Beam or BeamPair separately, for all possible mf states, and returns the total potential which is the weighted sum of both with the powers.
If a Surface has been set when initializing the simulation, the Casimir-Polder surface interactions are included.
Checks (with exists_in_past_simulation method) if a simulation with the same parameters has already been saved. If so, fetches the data without running a new simulation.
If not, creates a new .json with the parameters and a new .npy with the potentials object (of shape (number of beams,length of coordinate 1,length of coordinate 2,number of possible mf states)).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>plane</code></td>
<td><code>str</code></td>
<td>
<p>As the electrical fields specified are 3D, a slice has to be chosen. Either "XY", "YZ" or "XZ".</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>coord</code></td>
<td><code>float</code></td>
<td>
<p>Coordinate of the plane on the orthogonal axis (m).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>array </code></td>
<td>
<p>total potential with shape(length of axis,number of possible mf states)</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>nanotrappy\trapping\simulation.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compute_potential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
    <span class="sd">"""Computes the potential in 2D for each Beam or BeamPair separately, for all possible mf states, and returns the total potential which is the weighted sum of both with the powers.</span>
<span class="sd">    If a Surface has been set when initializing the simulation, the Casimir-Polder surface interactions are included.</span>
<span class="sd">    Checks (with exists_in_past_simulation method) if a simulation with the same parameters has already been saved. If so, fetches the data without running a new simulation.</span>
<span class="sd">    If not, creates a new .json with the parameters and a new .npy with the potentials object (of shape (number of beams,length of coordinate 1,length of coordinate 2,number of possible mf states)).</span>

<span class="sd">    Args:</span>
<span class="sd">        plane (str): As the electrical fields specified are 3D, a slice has to be chosen. Either "XY", "YZ" or "XZ".</span>
<span class="sd">        coord (float): Coordinate of the plane on the orthogonal axis (m).</span>

<span class="sd">    Returns:</span>
<span class="sd">       array : total potential with shape(length of axis,number of possible mf states)</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="s2">"2D"</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plane</span> <span class="o">=</span> <span class="n">plane</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="n">coord</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">axis_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coord1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord2</span> <span class="o">=</span> <span class="n">set_axis_from_plane</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="n">CP_mask</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">:</span>
        <span class="n">CP_mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">set_mask2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">coord</span><span class="p">))</span>
    <span class="n">CP_mask</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">C3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">CP_mask</span><span class="p">)</span> <span class="o">/</span> <span class="n">kB</span> <span class="o">/</span> <span class="n">mK</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">CP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">CP_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">CP_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mf_all</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mf_all</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CP</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">CP_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mf_shift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mf_all</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">f</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists_in_past_simulations</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Reusing data from file: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations/"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations/"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_file</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">already_saved</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_potential</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] New simulation"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict2D</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord2</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">mf_shift</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"complex"</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord2</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">mf_shift</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">mf_shift</span><span class="p">)),</span>
            <span class="n">dtype</span><span class="o">=</span><span class="s2">"complex"</span><span class="p">,</span>
        <span class="p">)</span>  <span class="c1"># last column contains the eigenvectors</span>

        <span class="c1">## Here we return a table, containing the potential induced by each Beam component of the Trap.</span>
        <span class="c1">## Thus, a BeamPair will return only one potential, as well as a Beam.</span>

        <span class="n">beam_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">potential_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">run</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">beam</span><span class="o">.</span><span class="n">isBeam</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Computing potential for a single beam..."</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">progressbar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord1</span><span class="p">)),</span> <span class="s2">"</span><span class="se">\n</span><span class="s2"> Computing: "</span><span class="p">,</span> <span class="mi">40</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord2</span><span class="p">)):</span>
                        <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">mf_shift</span><span class="p">])</span>
                        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">elt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vec</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">vecs</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">elt</span>

            <span class="k">elif</span> <span class="n">beam</span><span class="o">.</span><span class="n">isBeamPair</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas_contrapropag</span><span class="p">(</span><span class="o">*</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">())</span>

                <span class="c1"># sum light shifts and then diagonalize</span>
                <span class="k">if</span> <span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">"[INFO] Computing potential for the running wave with two beams with different frequencies"</span>
                    <span class="p">)</span>
                    <span class="n">E_bwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse_propagation_direction</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">beam_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">E_fwd</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span>
                    <span class="n">alpha0_f</span><span class="p">,</span> <span class="n">alpha1_f</span><span class="p">,</span> <span class="n">alpha2_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">alpha0_b</span><span class="p">,</span> <span class="n">alpha1_b</span><span class="p">,</span> <span class="n">alpha2_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E_fwd</span> <span class="o">+</span> <span class="n">E_bwd</span>

                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">progressbar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord1</span><span class="p">)),</span> <span class="s2">"</span><span class="se">\n</span><span class="s2"> Computing: "</span><span class="p">,</span> <span class="mi">40</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord2</span><span class="p">)):</span>
                            <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span>
                                <span class="n">E_fwd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">E_fwd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">E_fwd</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="n">tot_shift_f</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha0_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltascalar</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                                <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha1_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltavector</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                                <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha2_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltatensor</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                            <span class="p">)</span>

                            <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span>
                                <span class="n">E_bwd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">E_bwd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">E_bwd</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="n">tot_shift_b</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha0_b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltascalar</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                                <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha1_b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltavector</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                                <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha2_b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltatensor</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                            <span class="p">)</span>

                            <span class="n">tot_shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">tot_shift_f</span> <span class="o">+</span> <span class="n">tot_shift_b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mK</span> <span class="o">*</span> <span class="n">kB</span><span class="p">)</span>
                            <span class="n">vals</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">tot_shift</span><span class="p">)</span>
                            <span class="n">idx</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">mf_shift</span><span class="p">])</span>
                            <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">elt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="n">idx</span><span class="p">]):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">vecs</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">elt</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Done."</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Computing potential for the standing wave..."</span><span class="p">)</span>
                    <span class="n">E_bwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse_propagation_direction</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">beam_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span> <span class="o">+</span> <span class="n">E_bwd</span>

                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">progressbar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord1</span><span class="p">)),</span> <span class="s2">"</span><span class="se">\n</span><span class="s2"> Computing: "</span><span class="p">,</span> <span class="mi">40</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord2</span><span class="p">)):</span>
                            <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">mf_shift</span><span class="p">])</span>
                            <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">elt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vec</span><span class="p">):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">vecs</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">elt</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Done."</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Something bad happened. The trap should only contain Beam type objects"</span><span class="p">)</span>

            <span class="n">potential_number</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">beam_number</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">beam</span><span class="o">.</span><span class="n">isBeam</span><span class="p">()</span> <span class="k">else</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">already_saved</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_potential</span><span class="p">()</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="nanotrappy.trapping.simulation.Simulation.compute_potential_1D">
<code class="highlight language-python">
compute_potential_1D<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">coord1</span><span class="p">,</span> <span class="n">coord2</span><span class="p">,</span> <span class="n">contrib</span><span class="o">=</span><span class="s1">'scalar'</span><span class="p">)</span> </code>
<a class="headerlink" href="#nanotrappy.trapping.simulation.Simulation.compute_potential_1D" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Computes the potential in 2D for each Beam or BeamPair separately, for all possible mf states, and returns the total potential which is the weighted sum of both with the powers.
If a Surface has been set when initializing the simulation, the Casimir-Polder surface interactions are included.
Checks (with exists_in_past_simulation method) if a simulation with the same parameters has already been saved. If so, fetches the data without running a new simulation.
If not, creates a new .json with the parameters and a new .npy with the potentials object (of shape (number of beams,length of axis,number of possible mf states)).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>axis</code></td>
<td><code>str</code></td>
<td>
<p>As the electrical fields specified are 3D, an axis of observation has to be specified. Either "X", "Y" or "Z".</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>coord1</code></td>
<td><code>float</code></td>
<td>
<p>First coordinate of the axis position in the orthogonal plane. (m)</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>coord2</code></td>
<td><code>float</code></td>
<td>
<p>Second coordinate of the axis position in the orthogonal plane. (m)</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>array </code></td>
<td>
<p>total potential with shape(length of axis,number of possible mf states)</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>nanotrappy\trapping\simulation.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">compute_potential_1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">coord1</span><span class="p">,</span> <span class="n">coord2</span><span class="p">,</span> <span class="n">contrib</span><span class="o">=</span><span class="s2">"scalar"</span><span class="p">):</span>
    <span class="sd">"""Computes the potential in 2D for each Beam or BeamPair separately, for all possible mf states, and returns the total potential which is the weighted sum of both with the powers.</span>
<span class="sd">    If a Surface has been set when initializing the simulation, the Casimir-Polder surface interactions are included.</span>
<span class="sd">    Checks (with exists_in_past_simulation method) if a simulation with the same parameters has already been saved. If so, fetches the data without running a new simulation.</span>
<span class="sd">    If not, creates a new .json with the parameters and a new .npy with the potentials object (of shape (number of beams,length of axis,number of possible mf states)).</span>

<span class="sd">    Args:</span>
<span class="sd">        axis (str): As the electrical fields specified are 3D, an axis of observation has to be specified. Either "X", "Y" or "Z".</span>
<span class="sd">        coord1 (float): First coordinate of the axis position in the orthogonal plane. (m)</span>
<span class="sd">        coord2 (float): Second coordinate of the axis position in the orthogonal plane. (m)</span>

<span class="sd">    Returns:</span>
<span class="sd">       array : total potential with shape(length of axis,number of possible mf states)</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="s2">"1D"</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plane</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord2</span> <span class="o">=</span> <span class="n">coord1</span><span class="p">,</span> <span class="n">coord2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">axis_name</span> <span class="o">=</span> <span class="n">axis</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">set_axis_from_axis</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="n">mf_shift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mf_all</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">f</span>

    <span class="n">CP_mask</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">:</span>
        <span class="n">CP_mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">set_mask1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord2</span><span class="p">))</span>
    <span class="n">CP_mask</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">C3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">CP_mask</span><span class="p">)</span> <span class="o">/</span> <span class="n">kB</span> <span class="o">/</span> <span class="n">mK</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">CP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">CP_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mf_all</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists_in_past_simulations</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Reusing data from file: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations/"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations/"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_file</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">already_saved</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_potential</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] New simulation"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict1D</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_name</span><span class="p">,</span> <span class="n">coord1</span><span class="p">,</span> <span class="n">coord2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"You must give the electric fields in all 3 directions (one dimension can be of size 1)"</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">mf_shift</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"complex"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">mf_shift</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">mf_shift</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"complex"</span><span class="p">)</span>

        <span class="c1">## Here we return a table, containing the potential induced by each Beam component of the Trap.</span>
        <span class="c1">## Thus, a BeamPair will return only one potential, as well as a Beam.</span>

        <span class="n">beam_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">potential_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">beam</span><span class="o">.</span><span class="n">isBeam</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">)):</span>
                    <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">val</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                    <span class="c1"># val, _ = self.atomicsystem.potential_partial(Ep,Em,E0,contrib=contrib)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">mf_shift</span><span class="p">])</span>
                    <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">elt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vec</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vecs</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">elt</span>

            <span class="k">elif</span> <span class="n">beam</span><span class="o">.</span><span class="n">isBeamPair</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas_contrapropag</span><span class="p">(</span><span class="o">*</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">())</span>
                <span class="n">E_bwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse_propagation_direction</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">beam_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span> <span class="o">+</span> <span class="n">E_bwd</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas_contrapropag</span><span class="p">(</span><span class="o">*</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">())</span>

                <span class="k">if</span> <span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">"[INFO] Computing potential for the running wave with two beams with different frequencies"</span>
                    <span class="p">)</span>
                    <span class="n">E_bwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse_propagation_direction</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">beam_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">E_fwd</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span>
                    <span class="n">alpha0_f</span><span class="p">,</span> <span class="n">alpha1_f</span><span class="p">,</span> <span class="n">alpha2_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">alpha0_b</span><span class="p">,</span> <span class="n">alpha1_b</span><span class="p">,</span> <span class="n">alpha2_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E_fwd</span> <span class="o">+</span> <span class="n">E_bwd</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">)):</span>
                        <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span><span class="n">E_fwd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">E_fwd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">E_fwd</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                        <span class="n">tot_shift_f</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha0_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltascalar</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                            <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha1_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltavector</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                            <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha2_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltatensor</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span><span class="n">E_bwd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">E_bwd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">E_bwd</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                        <span class="n">tot_shift_b</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha0_b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltascalar</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                            <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha1_b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltavector</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                            <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha2_b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltatensor</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                        <span class="p">)</span>

                        <span class="n">tot_shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">tot_shift_f</span> <span class="o">+</span> <span class="n">tot_shift_b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mK</span> <span class="o">*</span> <span class="n">kB</span><span class="p">)</span>
                        <span class="n">vals</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">tot_shift</span><span class="p">)</span>
                        <span class="n">idx</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">mf_shift</span><span class="p">])</span>
                        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">elt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="n">idx</span><span class="p">]):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">vecs</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">elt</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Done."</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Computing potential for the standing wave..."</span><span class="p">)</span>
                    <span class="n">E_bwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse_propagation_direction</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">beam_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span> <span class="o">+</span> <span class="n">E_bwd</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">)):</span>
                        <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">mf_shift</span><span class="p">])</span>
                        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">elt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vec</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">vecs</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">elt</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Done."</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Something bad happened. The trap should only contain Beam type objects"</span><span class="p">)</span>

            <span class="n">potential_number</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">beam_number</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">beam</span><span class="o">.</span><span class="n">isBeam</span><span class="p">()</span> <span class="k">else</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">already_saved</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># self.finished.emit()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_potential</span><span class="p">()</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="nanotrappy.trapping.simulation.Simulation.compute_potential_1D_gui">
<code class="highlight language-python">
compute_potential_1D_gui<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">coord1</span><span class="p">,</span> <span class="n">coord2</span><span class="p">,</span> <span class="n">contrib</span><span class="o">=</span><span class="s1">'scalar'</span><span class="p">)</span> </code>
<a class="headerlink" href="#nanotrappy.trapping.simulation.Simulation.compute_potential_1D_gui" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Computes the potential in 2D for each Beam or BeamPair separately, for all possible mf states, and returns the total potential which is the weighted sum of both with the powers.
If a Surface has been set when initializing the simulation, the Casimir-Polder surface interactions are included.
Checks (with exists_in_past_simulation method) if a simulation with the same parameters has already been saved. If so, fetches the data without running a new simulation.
If not, creates a new .json with the parameters and a new .npy with the potentials object (of shape (number of beams,length of axis,number of possible mf states)).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>axis</code></td>
<td><code>str</code></td>
<td>
<p>As the electrical fields specified are 3D, an axis of observation has to be specified. Either "X", "Y" or "Z".</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>coord1</code></td>
<td><code>float</code></td>
<td>
<p>First coordinate of the axis position in the orthogonal plane. (m)</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>coord2</code></td>
<td><code>float</code></td>
<td>
<p>Second coordinate of the axis position in the orthogonal plane. (m)</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>array </code></td>
<td>
<p>total potential with shape(length of axis,number of possible mf states)</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>nanotrappy\trapping\simulation.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="nd">@pyqtSlot</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">compute_potential_1D_gui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">coord1</span><span class="p">,</span> <span class="n">coord2</span><span class="p">,</span> <span class="n">contrib</span><span class="o">=</span><span class="s2">"scalar"</span><span class="p">):</span>
    <span class="sd">"""Computes the potential in 2D for each Beam or BeamPair separately, for all possible mf states, and returns the total potential which is the weighted sum of both with the powers.</span>
<span class="sd">    If a Surface has been set when initializing the simulation, the Casimir-Polder surface interactions are included.</span>
<span class="sd">    Checks (with exists_in_past_simulation method) if a simulation with the same parameters has already been saved. If so, fetches the data without running a new simulation.</span>
<span class="sd">    If not, creates a new .json with the parameters and a new .npy with the potentials object (of shape (number of beams,length of axis,number of possible mf states)).</span>

<span class="sd">    Args:</span>
<span class="sd">        axis (str): As the electrical fields specified are 3D, an axis of observation has to be specified. Either "X", "Y" or "Z".</span>
<span class="sd">        coord1 (float): First coordinate of the axis position in the orthogonal plane. (m)</span>
<span class="sd">        coord2 (float): Second coordinate of the axis position in the orthogonal plane. (m)</span>

<span class="sd">    Returns:</span>
<span class="sd">       array : total potential with shape(length of axis,number of possible mf states)</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="s2">"1D"</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plane</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord2</span> <span class="o">=</span> <span class="n">coord1</span><span class="p">,</span> <span class="n">coord2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">axis_name</span> <span class="o">=</span> <span class="n">axis</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">set_axis_from_axis</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="n">mf_shift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mf_all</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">f</span>

    <span class="n">CP_mask</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">:</span>
        <span class="n">CP_mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">set_mask1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord2</span><span class="p">))</span>
    <span class="n">CP_mask</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">C3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">CP_mask</span><span class="p">)</span> <span class="o">/</span> <span class="n">kB</span> <span class="o">/</span> <span class="n">mK</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">CP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">CP_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mf_all</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists_in_past_simulations</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Reusing data from file: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations/"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations/"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_file</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">already_saved</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_potential</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] New simulation"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict1D</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_name</span><span class="p">,</span> <span class="n">coord1</span><span class="p">,</span> <span class="n">coord2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"You must give the electric fields in all 3 directions (one dimension can be of size 1)"</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">mf_shift</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"complex"</span><span class="p">)</span>

        <span class="c1">## Here we return a table, containing the potential induced by each Beam component of the Trap.</span>
        <span class="c1">## Thus, a BeamPair will return only one potential, as well as a Beam.</span>

        <span class="n">beam_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">potential_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">beam</span><span class="o">.</span><span class="n">isBeam</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span>

                <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">)):</span>
                    <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="c1"># val, vec = self.atomicsystem.potential(Ep, Em, E0)</span>
                    <span class="n">val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">potential_partial</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">mf_shift</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">beam_number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">beam</span><span class="o">.</span><span class="n">isBeamPair</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas_contrapropag</span><span class="p">(</span><span class="o">*</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">())</span>
                <span class="n">E_bwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse_propagation_direction</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">beam_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span> <span class="o">+</span> <span class="n">E_bwd</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas_contrapropag</span><span class="p">(</span><span class="o">*</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">())</span>

                <span class="k">if</span> <span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">"[INFO] Computing potential for the running wave with two beams with different frequencies"</span>
                    <span class="p">)</span>
                    <span class="n">E_bwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse_propagation_direction</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">beam_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">E_fwd</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span>
                    <span class="n">alpha0_f</span><span class="p">,</span> <span class="n">alpha1_f</span><span class="p">,</span> <span class="n">alpha2_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">alpha0_b</span><span class="p">,</span> <span class="n">alpha1_b</span><span class="p">,</span> <span class="n">alpha2_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E_fwd</span> <span class="o">+</span> <span class="n">E_bwd</span>

                    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">)):</span>
                        <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span><span class="n">E_fwd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">E_fwd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">E_fwd</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                        <span class="n">tot_shift_f</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha0_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltascalar</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                            <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha1_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltavector</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                            <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha2_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltatensor</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span><span class="n">E_bwd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">E_bwd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">E_bwd</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
                        <span class="n">tot_shift_b</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha0_b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltascalar</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                            <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha1_b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltavector</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                            <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha2_b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">deltatensor</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                        <span class="p">)</span>

                        <span class="n">tot_shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">tot_shift_f</span> <span class="o">+</span> <span class="n">tot_shift_b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mK</span> <span class="o">*</span> <span class="n">kB</span><span class="p">)</span>
                        <span class="n">vals</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">tot_shift</span><span class="p">)</span>
                        <span class="n">idx</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">mf_shift</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">beam_number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Done."</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Computing potential for the standing wave..."</span><span class="p">)</span>
                    <span class="n">E_bwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse_propagation_direction</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">beam_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span> <span class="o">+</span> <span class="n">E_bwd</span>

                    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">)):</span>
                        <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">mf_shift</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">beam_number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Done."</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Something bad happened. The trap should only contain Beam type objects"</span><span class="p">)</span>

            <span class="n">potential_number</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">beam_number</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">beam</span><span class="o">.</span><span class="n">isBeam</span><span class="p">()</span> <span class="k">else</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">already_saved</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_potential</span><span class="p">()</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="nanotrappy.trapping.simulation.Simulation.compute_potential_gui">
<code class="highlight language-python">
compute_potential_gui<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span> </code>
<a class="headerlink" href="#nanotrappy.trapping.simulation.Simulation.compute_potential_gui" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Computes the potential in 2D for each Beam or BeamPair separately, for all possible mf states, and returns the total potential which is the weighted sum of both with the powers.
If a Surface has been set when initializing the simulation, the Casimir-Polder surface interactions are included.
Checks (with exists_in_past_simulation method) if a simulation with the same parameters has already been saved. If so, fetches the data without running a new simulation.
If not, creates a new .json with the parameters and a new .npy with the potentials object (of shape (number of beams,length of coordinate 1,length of coordinate 2,number of possible mf states)).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>plane</code></td>
<td><code>str</code></td>
<td>
<p>As the electrical fields specified are 3D, a slice has to be chosen. Either "XY", "YZ" or "XZ".</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>coord</code></td>
<td><code>float</code></td>
<td>
<p>Coordinate of the plane on the orthogonal axis (m).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>array </code></td>
<td>
<p>total potential with shape(length of axis,number of possible mf states)</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>nanotrappy\trapping\simulation.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="nd">@pyqtSlot</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">compute_potential_gui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
    <span class="sd">"""Computes the potential in 2D for each Beam or BeamPair separately, for all possible mf states, and returns the total potential which is the weighted sum of both with the powers.</span>
<span class="sd">    If a Surface has been set when initializing the simulation, the Casimir-Polder surface interactions are included.</span>
<span class="sd">    Checks (with exists_in_past_simulation method) if a simulation with the same parameters has already been saved. If so, fetches the data without running a new simulation.</span>
<span class="sd">    If not, creates a new .json with the parameters and a new .npy with the potentials object (of shape (number of beams,length of coordinate 1,length of coordinate 2,number of possible mf states)).</span>

<span class="sd">    Args:</span>
<span class="sd">        plane (str): As the electrical fields specified are 3D, a slice has to be chosen. Either "XY", "YZ" or "XZ".</span>
<span class="sd">        coord (float): Coordinate of the plane on the orthogonal axis (m).</span>

<span class="sd">    Returns:</span>
<span class="sd">       array : total potential with shape(length of axis,number of possible mf states)</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="s2">"2D"</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plane</span> <span class="o">=</span> <span class="n">plane</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="n">coord</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">axis_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coord1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord2</span> <span class="o">=</span> <span class="n">set_axis_from_plane</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="n">CP_mask</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">:</span>
        <span class="n">CP_mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">set_mask2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">coord</span><span class="p">))</span>
    <span class="n">CP_mask</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">C3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">CP_mask</span><span class="p">)</span> <span class="o">/</span> <span class="n">kB</span> <span class="o">/</span> <span class="n">mK</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">CP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">CP_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">CP_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mf_all</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mf_all</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CP</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">CP_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mf_shift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mf_all</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">f</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists_in_past_simulations</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Reusing data from file: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations/"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations/"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_file</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">already_saved</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_potential</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] New simulation"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict2D</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord2</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">mf_shift</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"complex"</span>
        <span class="p">)</span>

        <span class="c1">## Here we return a table, containing the potential induced by each Beam component of the Trap.</span>
        <span class="c1">## Thus, a BeamPair will return only one potential, as well as a Beam.</span>

        <span class="n">beam_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">potential_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">run</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">beam</span><span class="o">.</span><span class="n">isBeam</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Computing potential for a single beam..."</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span>

                <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord1</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord2</span><span class="p">)):</span>
                        <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">mf_shift</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">beam_number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">beam</span><span class="o">.</span><span class="n">isBeamPair</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas_contrapropag</span><span class="p">(</span><span class="o">*</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">())</span>

                <span class="c1"># sum light shifts and then diagonalize</span>
                <span class="k">if</span> <span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">"[INFO] Computing potential for the running wave with two beams with different frequencies"</span>
                    <span class="p">)</span>
                    <span class="n">E_bwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse_propagation_direction</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">beam_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">E_fwd</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span>
                    <span class="n">alpha0_f</span><span class="p">,</span> <span class="n">alpha1_f</span><span class="p">,</span> <span class="n">alpha2_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">alpha0_b</span><span class="p">,</span> <span class="n">alpha1_b</span><span class="p">,</span> <span class="n">alpha2_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E_fwd</span> <span class="o">+</span> <span class="n">E_bwd</span>

                    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord1</span><span class="p">)):</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord2</span><span class="p">)):</span>
                            <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span>
                                <span class="n">E_fwd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">E_fwd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">E_fwd</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="n">tot_shift_f</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha0_f</span> <span class="o">*</span> <span class="n">deltascalar</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                                <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha1_f</span> <span class="o">*</span> <span class="n">deltavector</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                                <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha2_f</span> <span class="o">*</span> <span class="n">deltatensor</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                            <span class="p">)</span>

                            <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span>
                                <span class="n">E_bwd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">E_bwd</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">E_bwd</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="n">tot_shift_b</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha0_b</span> <span class="o">*</span> <span class="n">deltascalar</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                                <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha1_b</span> <span class="o">*</span> <span class="n">deltavector</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                                <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">alpha2_b</span> <span class="o">*</span> <span class="n">deltatensor</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
                            <span class="p">)</span>

                            <span class="n">tot_shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">tot_shift_f</span> <span class="o">+</span> <span class="n">tot_shift_b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mK</span> <span class="o">*</span> <span class="n">kB</span><span class="p">)</span>
                            <span class="n">vals</span><span class="p">,</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">tot_shift</span><span class="p">)</span>
                            <span class="n">idx</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">mf_shift</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">beam_number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Done."</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Computing potential for the standing wave..."</span><span class="p">)</span>
                    <span class="n">E_bwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse_propagation_direction</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">beam_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span> <span class="o">+</span> <span class="n">E_bwd</span>

                    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord1</span><span class="p">)):</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord2</span><span class="p">)):</span>
                            <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="n">val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">mf_shift</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">beam_number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Done."</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Something bad happened. The trap should only contain Beam type objects"</span><span class="p">)</span>

            <span class="n">potential_number</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">beam_number</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">beam</span><span class="o">.</span><span class="n">isBeam</span><span class="p">()</span> <span class="k">else</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">already_saved</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_potential</span><span class="p">()</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="nanotrappy.trapping.simulation.Simulation.compute_potential_gui2">
<code class="highlight language-python">
compute_potential_gui2<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span> </code>
<a class="headerlink" href="#nanotrappy.trapping.simulation.Simulation.compute_potential_gui2" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Computes the potential in 2D for each Beam or BeamPair separately, for all possible mf states, and returns the total potential which is the weighted sum of both with the powers.
If a Surface has been set when initializing the simulation, the Casimir-Polder surface interactions are included.
Checks (with exists_in_past_simulation method) if a simulation with the same parameters has already been saved. If so, fetches the data without running a new simulation.
If not, creates a new .json with the parameters and a new .npy with the potentials object (of shape (number of beams,length of coordinate 1,length of coordinate 2,number of possible mf states)).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>plane</code></td>
<td><code>str</code></td>
<td>
<p>As the electrical fields specified are 3D, a slice has to be chosen. Either "XY", "YZ" or "XZ".</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>coord</code></td>
<td><code>float</code></td>
<td>
<p>Coordinate of the plane on the orthogonal axis (m).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>array </code></td>
<td>
<p>total potential with shape(length of axis,number of possible mf states)</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>nanotrappy\trapping\simulation.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="nd">@pyqtSlot</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">compute_potential_gui2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
    <span class="sd">"""Computes the potential in 2D for each Beam or BeamPair separately, for all possible mf states, and returns the total potential which is the weighted sum of both with the powers.</span>
<span class="sd">    If a Surface has been set when initializing the simulation, the Casimir-Polder surface interactions are included.</span>
<span class="sd">    Checks (with exists_in_past_simulation method) if a simulation with the same parameters has already been saved. If so, fetches the data without running a new simulation.</span>
<span class="sd">    If not, creates a new .json with the parameters and a new .npy with the potentials object (of shape (number of beams,length of coordinate 1,length of coordinate 2,number of possible mf states)).</span>

<span class="sd">    Args:</span>
<span class="sd">        plane (str): As the electrical fields specified are 3D, a slice has to be chosen. Either "XY", "YZ" or "XZ".</span>
<span class="sd">        coord (float): Coordinate of the plane on the orthogonal axis (m).</span>

<span class="sd">    Returns:</span>
<span class="sd">       array : total potential with shape(length of axis,number of possible mf states)</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="s2">"2D"</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plane</span> <span class="o">=</span> <span class="n">plane</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="n">coord</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">axis_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coord1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord2</span> <span class="o">=</span> <span class="n">set_axis_from_plane</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="n">CP_mask</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">:</span>
        <span class="n">CP_mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surface</span><span class="o">.</span><span class="n">set_mask2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">coord</span><span class="p">))</span>
    <span class="n">CP_mask</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">C3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">CP_mask</span><span class="p">)</span> <span class="o">/</span> <span class="n">kB</span> <span class="o">/</span> <span class="n">mK</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">CP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">CP_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">CP_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mf_all</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mf_all</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CP</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">CP_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mf_shift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mf_all</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">f</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists_in_past_simulations</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Reusing data from file: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations/"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations/"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_file</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">already_saved</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_potential</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] New simulation"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict2D</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord2</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">mf_shift</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"complex"</span>
        <span class="p">)</span>

        <span class="c1">## Here we return a table, containing the potential induced by each Beam component of the Trap.</span>
        <span class="c1">## Thus, a BeamPair will return only one potential, as well as a Beam.</span>

        <span class="n">beam_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">potential_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">beam</span><span class="o">.</span><span class="n">isBeam</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Computing potential for a single beam..."</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">beam</span><span class="o">.</span><span class="n">isBeamPair</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">set_alphas_contrapropag</span><span class="p">(</span><span class="o">*</span><span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">())</span>
                <span class="n">E_bwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse_propagation_direction</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">beam_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="c1"># fig,ax = plt.subplots()</span>
                <span class="c1"># plt.imshow(np.imag(E_bwd[2,:,:]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">beam_number</span><span class="p">]</span> <span class="o">+</span> <span class="n">E_bwd</span>

                <span class="c1"># fig,ax = plt.subplots()</span>
                <span class="c1"># plt.imshow(np.imag(Etot[2,:,:]))</span>
                <span class="c1"># plt.colorbar()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Something bad happened. The trap should only contain Beam type objects"</span><span class="p">)</span>

            <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord1</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord2</span><span class="p">)):</span>
                    <span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span> <span class="o">=</span> <span class="n">convert_fields_to_spherical_basis</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">Ep</span><span class="p">,</span> <span class="n">Em</span><span class="p">,</span> <span class="n">E0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">[</span><span class="n">potential_number</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">mf_shift</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_signal</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">beam_number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">benchmark</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>
            <span class="n">potential_number</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">beam_number</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">beam</span><span class="o">.</span><span class="n">isBeam</span><span class="p">()</span> <span class="k">else</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">already_saved</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_potential</span><span class="p">()</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="nanotrappy.trapping.simulation.Simulation.exists_in_past_simulations">
<code class="highlight language-python">
exists_in_past_simulations<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#nanotrappy.trapping.simulation.Simulation.exists_in_past_simulations" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>This method checks if the simulation about to be run has already been saved in the "simulations" folder, by checking the .json parameter files.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(tuple)</code></td>
<td>
<p>tuple containing:</p>
<div class="highlight">
<pre><span></span><code>- bool : True if simulation already exists, False otherwise.
- str : Name of the file if the simulation has already been run.
</code></pre>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>nanotrappy\trapping\simulation.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">exists_in_past_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""This method checks if the simulation about to be run has already been saved in the "simulations" folder, by checking the .json parameter files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): tuple containing:</span>

<span class="sd">            - bool : True if simulation already exists, False otherwise.</span>
<span class="sd">            - str : Name of the file if the simulation has already been run.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_current_params</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations"</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations"</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">".json"</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations/"</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>

            <span class="c1"># initializing compare keys</span>
            <span class="n">comp_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Atomic system"</span><span class="p">,</span> <span class="s2">"Material"</span><span class="p">,</span> <span class="s2">"Trap wavelengths"</span><span class="p">,</span> <span class="s2">"Considered state"</span><span class="p">,</span> <span class="s2">"Geometry"</span><span class="p">,</span> <span class="s2">"Surface"</span><span class="p">]</span>

            <span class="c1"># Compare Dictionaries on certain keys using all()</span>
            <span class="n">res</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">comp_keys</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_file</span> <span class="o">=</span> <span class="n">file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"npy"</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">E_file</span> <span class="o">=</span> <span class="n">file</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"E_field.npy"</span>
                <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="nanotrappy.trapping.simulation.Simulation.restrict1D">
<code class="highlight language-python">
restrict1D<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span> </code>
<a class="headerlink" href="#nanotrappy.trapping.simulation.Simulation.restrict1D" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>This method restricts the 3D arrays of the electric fields to 1D arrays.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>axis</code></td>
<td><code>str</code></td>
<td>
<p>Either "X", "Y" or "Z".</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>x1</code></td>
<td><code>float</code></td>
<td>
<p>First coordinate in the orthogonal plane. The coordinates should be given in the 'XYZ' order. If axis is 'Y', x1 would correspond to 'X', x2 to 'Z' (m).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>x2</code></td>
<td><code>float</code></td>
<td>
<p>Second coordinate in the orthogonal plane (m).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>list </code></td>
<td>
<p>list of the electric fields for the trap in 1D arrays.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>nanotrappy\trapping\simulation.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">restrict1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
    <span class="sd">"""This method restricts the 3D arrays of the electric fields to 1D arrays.</span>

<span class="sd">    Args:</span>
<span class="sd">        axis (str): Either "X", "Y" or "Z".</span>
<span class="sd">        x1 (float): First coordinate in the orthogonal plane. The coordinates should be given in the 'XYZ' order. If axis is 'Y', x1 would correspond to 'X', x2 to 'Z' (m).</span>
<span class="sd">        x2 (float): Second coordinate in the orthogonal plane (m).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list : list of the electric fields for the trap in 1D arrays.</span>
<span class="sd">    """</span>
    <span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">))]</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">"X"</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
        <span class="n">index_coord_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord1</span> <span class="o">-</span> <span class="n">x1</span><span class="p">))</span>
        <span class="n">index_coord_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord2</span> <span class="o">-</span> <span class="n">x2</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)):</span>  <span class="c1"># number of wavelengths</span>
            <span class="n">E</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="n">j</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">index_coord_1</span><span class="p">,</span> <span class="n">index_coord_2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">E</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">"Y"</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
        <span class="n">index_coord_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord1</span> <span class="o">-</span> <span class="n">x1</span><span class="p">))</span>
        <span class="n">index_coord_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord2</span> <span class="o">-</span> <span class="n">x2</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)):</span>  <span class="c1"># number of wavelengths</span>
            <span class="n">E</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="n">j</span><span class="p">][:,</span> <span class="n">index_coord_1</span><span class="p">,</span> <span class="p">:,</span> <span class="n">index_coord_2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">E</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">"Z"</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">index_coord_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord1</span> <span class="o">-</span> <span class="n">x1</span><span class="p">))</span>
        <span class="n">index_coord_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord2</span> <span class="o">-</span> <span class="n">x2</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)):</span>  <span class="c1"># number of wavelengths</span>
            <span class="n">E</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="n">j</span><span class="p">][:,</span> <span class="n">index_coord_1</span><span class="p">,</span> <span class="n">index_coord_2</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">E</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="nanotrappy.trapping.simulation.Simulation.restrict2D">
<code class="highlight language-python">
restrict2D<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">coord_value</span><span class="p">)</span> </code>
<a class="headerlink" href="#nanotrappy.trapping.simulation.Simulation.restrict2D" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>This method restricts the 3D arrays of the electric fields to 2D arrays
in a chosen plane and coordinate in the axis perpendicular to said plane.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>plane</code></td>
<td><code>str</code></td>
<td>
<p>Either "XY", "YZ" or "XZ".</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>coord_value</code></td>
<td><code>float</code></td>
<td>
<p>Coordinate of slice in the perpendicular axis (m).</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>list </code></td>
<td>
<p>list of the electric fields for the trap in 2D arrays.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>nanotrappy\trapping\simulation.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">restrict2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">coord_value</span><span class="p">):</span>
    <span class="sd">"""This method restricts the 3D arrays of the electric fields to 2D arrays</span>
<span class="sd">    in a chosen plane and coordinate in the axis perpendicular to said plane.</span>

<span class="sd">    Args:</span>
<span class="sd">        plane (str): Either "XY", "YZ" or "XZ".</span>
<span class="sd">        coord_value (float): Coordinate of slice in the perpendicular axis (m).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list : list of the electric fields for the trap in 2D arrays.</span>
<span class="sd">    """</span>
    <span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">))]</span>
    <span class="k">if</span> <span class="n">plane</span> <span class="o">==</span> <span class="s2">"XY"</span><span class="p">:</span>
        <span class="n">coord3</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
    <span class="k">elif</span> <span class="n">plane</span> <span class="o">==</span> <span class="s2">"YZ"</span><span class="p">:</span>
        <span class="n">coord3</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
    <span class="k">elif</span> <span class="n">plane</span> <span class="o">==</span> <span class="s2">"XZ"</span><span class="p">:</span>
        <span class="n">coord3</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
    <span class="n">index_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">-</span> <span class="n">coord_value</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)):</span>  <span class="c1"># number of wavelengths</span>
        <span class="n">E</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">index_coord</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">coord3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">E</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="nanotrappy.trapping.simulation.Simulation.save">
<code class="highlight language-python">
save<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#nanotrappy.trapping.simulation.Simulation.save" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Saves both the parameters dictionnary into a .json file and the potentials attribute into a .npy.</p>
<details class="quote">
<summary>Source code in <code>nanotrappy\trapping\simulation.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Saves both the parameters dictionnary into a .json file and the potentials attribute into a .npy."""</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">already_saved</span><span class="p">:</span>

        <span class="n">current_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">"Time of simulation"</span><span class="p">]</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">current_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">current_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">":"</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">current_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span>

        <span class="n">filename_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations/"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span> <span class="o">+</span> <span class="s2">".json"</span>
        <span class="n">filename_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations/"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span> <span class="o">+</span> <span class="s2">".npy"</span>
        <span class="n">E_filename_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"/simulations/"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"E_field.npy"</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename_params</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename_params</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># Guard against race condition</span>
                <span class="k">if</span> <span class="n">exc</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">errno</span><span class="o">.</span><span class="n">EEXIST</span><span class="p">:</span>
                    <span class="k">raise</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_params</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>

        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">E_filename_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">already_saved</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"This simulation has already been saved, see </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file</span><span class="p">))</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="nanotrappy.trapping.simulation.Simulation.set_current_params">
<code class="highlight language-python">
set_current_params<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#nanotrappy.trapping.simulation.Simulation.set_current_params" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Sets a dictionnary with all the relevant parameters of the Simulation object and returns it.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dict </code></td>
<td>
<p>parameters of the simulation</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>nanotrappy\trapping\simulation.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">set_current_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Sets a dictionnary with all the relevant parameters of the Simulation object and returns it.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict : parameters of the simulation</span>
<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmbdas_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">P_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">beam</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmbdas_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmbdas_params</span><span class="p">,</span> <span class="n">beam</span><span class="o">.</span><span class="n">get_lmbda</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P_params</span><span class="p">,</span> <span class="n">beam</span><span class="o">.</span><span class="n">get_power</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmbdas_params</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">refcheck</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P_params</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">refcheck</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lmbdas_params</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">refcheck</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">P_params</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">refcheck</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">lambda1pair1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmbdas_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">nm</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" nm"</span>
    <span class="n">power1pair1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">mW</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" mW"</span>
    <span class="n">lambda2pair1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmbdas_params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">nm</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" nm"</span>
    <span class="n">power2pair1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P_params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">mW</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" mW"</span>

    <span class="n">lambda1pair2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmbdas_params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">nm</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" nm"</span>
    <span class="n">power1pair2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P_params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">mW</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" mW"</span>
    <span class="n">lambda2pair2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmbdas_params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">nm</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" nm"</span>
    <span class="n">power2pair2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P_params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">mW</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" mW"</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"</span><span class="si">%d</span><span class="s2">/%m/%Y %H:%M:%S"</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"Time of simulation"</span><span class="p">:</span> <span class="n">current_time</span><span class="p">,</span>
        <span class="s2">"Atomic system"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"species"</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s2">"groundstate"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">groundstate</span><span class="p">),</span>
            <span class="s2">"hyperfine level"</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">f</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s2">"Material"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">),</span>
        <span class="s2">"Trap wavelengths"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"lambda 1 pair 1"</span><span class="p">:</span> <span class="n">lambda1pair1</span><span class="p">,</span>
            <span class="s2">"lambda 2 pair 1"</span><span class="p">:</span> <span class="n">lambda2pair1</span><span class="p">,</span>
            <span class="s2">"lambda 1 pair 2"</span><span class="p">:</span> <span class="n">lambda1pair2</span><span class="p">,</span>
            <span class="s2">"lambda 2 pair 2"</span><span class="p">:</span> <span class="n">lambda2pair2</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">"Trap powers"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"power 1 pair 1"</span><span class="p">:</span> <span class="n">power1pair1</span><span class="p">,</span>
            <span class="s2">"power 2 pair 1"</span><span class="p">:</span> <span class="n">power2pair1</span><span class="p">,</span>
            <span class="s2">"power 1 pair 2"</span><span class="p">:</span> <span class="n">power1pair2</span><span class="p">,</span>
            <span class="s2">"power 2 pair 2"</span><span class="p">:</span> <span class="n">power2pair2</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">"Considered state"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atomicsystem</span><span class="o">.</span><span class="n">state</span><span class="p">),</span>
        <span class="s2">"Geometry"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"2D"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="s2">"2D"</span><span class="p">,</span>
            <span class="s2">"2D plane"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane</span><span class="p">,</span>
            <span class="s2">"2D orthogonal coord"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">,</span>
            <span class="s2">"1D"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">==</span> <span class="s2">"1D"</span><span class="p">,</span>
            <span class="s2">"1D axis"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_name</span><span class="p">,</span>
            <span class="s2">"1D coord1"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord1</span><span class="p">,</span>
            <span class="s2">"1D coord2"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plane_coord2</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">"Surface"</span><span class="p">:</span> <span class="p">[</span><span class="n">surface</span><span class="o">.</span><span class="n">params</span> <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">],</span>
        <span class="s2">"Data_folder"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_folder</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"[INFO] Simulation parameters set"</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="nanotrappy.trapping.simulation.Simulation.set_wavelengths_indices">
<code class="highlight language-python">
set_wavelengths_indices<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#nanotrappy.trapping.simulation.Simulation.set_wavelengths_indices" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Compares the wavelengths of the beams specified for the trap with the wavelengths of the available modes in the data folder and returns the list of the file indices that correspond.
The wavelengths are rounded to 0.01 nm before comparison.</p>
<div class="highlight">
<pre><span></span><code>!!! note
    Passed as property so it is updated anytime the trap is changed

!!! raises
    ValueError: If at least one wavelength wanted for the trap cannot be found in the data folder.
</code></pre>
</div>
<details class="quote">
<summary>Source code in <code>nanotrappy\trapping\simulation.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">set_wavelengths_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Compares the wavelengths of the beams specified for the trap with the wavelengths of the available modes in the data folder and returns the list of the file indices that correspond.</span>
<span class="sd">    The wavelengths are rounded to 0.01 nm before comparison.</span>

<span class="sd">        Note:</span>
<span class="sd">            Passed as property so it is updated anytime the trap is changed</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If at least one wavelength wanted for the trap cannot be found in the data folder.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wavelengths_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">lmbdas</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmbdas_modes</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wavelengths_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelengths_indices</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Demanded wavelengths for trap not found in data folder, the possible wavelengths are the following: "</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmbdas_modes</span><span class="p">),</span>
            <span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="nanotrappy.trapping.simulation.Simulation.total_potential">
<code class="highlight language-python">
total_potential<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#nanotrappy.trapping.simulation.Simulation.total_potential" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Uses the potentials attributes of the Simulation object for each beam to return their weighted sum with the specified powers</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>total potential </code></td>
<td>
<p>array with shape(length coordinate 1,length coordinate 2,number of possbile mf states)</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>nanotrappy\trapping\simulation.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">total_potential</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Uses the potentials attributes of the Simulation object for each beam to return their weighted sum with the specified powers</span>

<span class="sd">    Returns:</span>
<span class="sd">        total potential : array with shape(length coordinate 1,length coordinate 2,number of possbile mf states)</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_potential_noCP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vecs</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"complex"</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">potential</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potentials</span><span class="p">):</span>
        <span class="c1"># if self.trap.beams[i].__class__.__name__ == "Beam" :</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Beam</span><span class="p">):</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_potential_noCP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_potential_noCP</span> <span class="o">+</span> <span class="n">mult</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_power</span><span class="p">()</span> <span class="o">*</span> <span class="n">potential</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_vecs</span> <span class="o">=</span> <span class="n">mult</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">trap</span><span class="o">.</span><span class="n">beams</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_power</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vecs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">norm_total_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_vecs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_vecs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_vecs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">/=</span> <span class="n">norm_total_vecs</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_potential_noCP</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">CP</span>
</code></pre>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="nanotrappy.trapping.simulation.parse_lmbdas">
<code class="highlight language-python">
parse_lmbdas<span class="p">(</span><span class="n">data_folder</span><span class="p">)</span> </code>
<a class="headerlink" href="#nanotrappy.trapping.simulation.parse_lmbdas" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<p>This function opens all the .npy file of the given data_folder and stores the wavelengths of the modes in an array.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data_folder</code></td>
<td><code>str</code></td>
<td>
<p>Absolute path of the folder containing the computed available modes.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>array </code></td>
<td>
<p>np array with all the available wavelengths.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>nanotrappy\trapping\simulation.py</code></summary>
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parse_lmbdas</span><span class="p">(</span><span class="n">data_folder</span><span class="p">):</span>
    <span class="sd">"""This function opens all the .npy file of the given data_folder and stores the wavelengths of the modes in an array.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_folder (str): Absolute path of the folder containing the computed available modes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        array : np array with all the available wavelengths.</span>
<span class="sd">    """</span>
    <span class="n">lmbdas_modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">data_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">".npy"</span><span class="p">)])</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_folder</span> <span class="o">+</span> <span class="s2">"//"</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lmbdas_modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lmbdas_modes</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lmbdas_modes</span>
</code></pre>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav aria-label="Footer" class="md-footer-nav__inner md-grid">
<a class="md-footer-nav__link md-footer-nav__link--prev" href="../atomicsystem/" rel="prev">
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Previous
                </span>
                Atomic system
              </div>
</div>
</a>
<a class="md-footer-nav__link md-footer-nav__link--next" href="../trap/" rel="next">
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                Trap
              </div>
</div>
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            Copyright © 2020-2021 Jérémy Berroir &amp; Adrien Bouscal
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
<div class="md-footer-social">
<a class="md-footer-social__link" href="https://github.com/jrmbr" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<script src="../../assets/javascripts/vendor.08c56446.min.js"></script>
<script src="../../assets/javascripts/bundle.6ced434e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
<script>
        app = initialize({
          base: "../..",
          features: ['navigation.sections', 'navigation.tabs'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
</body>
</html>